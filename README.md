# 圆圈修复工具 - Web前端版

这是一个基于OpenCV.js的纯前端圆圈修复工具，可以智能检测并修复图像中被涂改的圆圈。

## 功能特点

- 🎯 **智能检测**: 自动识别图像中的圆圈位置
- 🔧 **自动修复**: 使用模板匹配技术修复被涂改的圆圈
- 🖱️ **交互式选择**: 通过鼠标拖拽选择干净的圆圈作为修复模板
- ⚙️ **参数调节**: 可调节检测阈值以适应不同图像
- 💾 **结果下载**: 一键下载修复后的图像
- 🌐 **纯前端**: 无需服务器，本地运行，保护隐私

## 文件结构

```
web-frontend/
├── index.html          # 主页面
├── js/                 # JavaScript文件目录
│   ├── circle-repair.js    # 核心JavaScript逻辑
│   └── opencv.js          # OpenCV.js库文件
├── assets/             # 资源文件目录
│   └── sample-image.svg   # 示例图片
└── README.md          # 说明文档
```

## 使用方法

### 1. 启动应用

直接在浏览器中打开 `index.html` 文件即可使用。

**注意**: 由于浏览器安全策略，建议通过本地服务器运行：

```bash
# 使用Python启动简单服务器
python -m http.server 8000

# 或使用Node.js
npx serve .

# 或使用Live Server扩展（推荐）
# 在VS Code中安装Live Server扩展，右键index.html选择"Open with Live Server"

# 然后在浏览器访问 http://localhost:8000
```

### 2. 操作步骤

1. **上传图片**: 点击"选择图片"按钮或直接拖拽图片到上传区域
2. **选择模板**: 在原图上用鼠标拖拽框选一个**干净未涂改**的圆圈
3. **调整参数** (可选):
   - **模板匹配阈值**: 控制圆圈识别的严格程度 (0.6-0.9)
   - **深色像素比例阈值**: 判断圆圈是否被涂改的标准 (0.01-0.1)
4. **开始修复**: 点击"开始修复"按钮
5. **下载结果**: 修复完成后点击"下载结果"保存图片

### 3. 参数说明

- **模板匹配阈值**: 数值越高，匹配越严格，可能遗漏一些圆圈；数值越低，可能误识别其他形状
- **深色像素比例阈值**: 数值越低，对涂改越敏感；数值越高，只检测重度涂改

## 技术实现

### 核心算法

1. **模板匹配**: 使用OpenCV的`matchTemplate`函数找到所有相似的圆圈位置
2. **涂改检测**: 通过分析像素亮度分布和边缘特征判断圆圈是否被涂改
3. **智能修复**: 用干净的模板替换被涂改的区域

### 技术栈

- **OpenCV.js**: 图像处理核心库
- **HTML5 Canvas**: 图像显示和交互
- **原生JavaScript**: 业务逻辑实现
- **CSS3**: 现代化UI设计

## 浏览器兼容性

- ✅ Chrome 57+
- ✅ Firefox 52+
- ✅ Safari 11+
- ✅ Edge 16+

## 性能优化

- 图像自动缩放以提高处理速度
- 内存管理优化，及时释放OpenCV对象
- 异步处理避免UI阻塞

## 注意事项

1. **图像质量**: 建议使用清晰度较高的图像以获得更好的修复效果
2. **模板选择**: 选择的模板圆圈应该完整、清晰、未被涂改
3. **浏览器性能**: 大尺寸图像可能需要较长处理时间
4. **隐私保护**: 所有处理都在本地进行，图像不会上传到服务器

## 故障排除

### 常见问题

**Q: OpenCV.js加载失败**
A: 检查网络连接，或尝试刷新页面重新加载

**Q: 修复效果不理想**
A: 尝试调整参数，或选择更清晰的模板圆圈

**Q: 浏览器卡顿**
A: 尝试使用较小尺寸的图像，或关闭其他标签页释放内存

**Q: 无法选择模板**
A: 确保图像已完全加载，检查浏览器控制台是否有错误信息

## 开发说明

### 本地开发

1. 确保OpenCV.js文件存在且可访问
2. 使用现代浏览器的开发者工具进行调试
3. 注意内存管理，及时删除OpenCV Mat对象

### 扩展功能

可以考虑添加的功能：
- 批量处理多张图片
- 更多图像格式支持
- 高级参数调节
- 处理进度显示
- 结果对比视图

## 许可证

本项目基于MIT许可证开源。

## 更新日志

### v1.0.0 (2024-01-XX)
- 初始版本发布
- 基础圆圈检测和修复功能
- 交互式模板选择
- 参数调节界面
- 结果下载功能